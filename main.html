<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoria Diagnostics - Multi-Modal Alzheimer's Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .recording {
            animation: pulse 1.5s infinite;
            background-color: #ef4444; /* Red-500 */
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .nav-link.active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #chat-window {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb; /* Light gray border */
            border-radius: 0.5rem; /* Rounded corners */
            padding: 1rem; /* Padding inside */
            background-color: #f9fafb; /* Light background */
        }
        .chat-message-user {
            background-color: #3b82f6; /* Blue-500 */
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0;
        }
        .chat-message-model {
            background-color: #e5e7eb; /* Gray-200 */
            color: #1f2937; /* Gray-800 */
            margin-right: auto;
            border-bottom-left-radius: 0;
        }
        .chat-message-container {
            display: flex;
            margin-bottom: 0.75rem;
        }
        .chat-message-content {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            max-width: 75%;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header Navigation -->
    <header class="bg-white shadow-lg sticky top-0 z-10">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex-shrink-0">
                    <a href="#home" class="text-2xl font-bold text-gray-800 flex items-center">
                       <img src="logo.jpeg" alt="Memoria Diagnostics Logo" class="w-16 h-16 mr-3 rounded-xl shadow-sm">
                        Memoria Diagnostics
                    </a>
                </div>
                <div class="flex space-x-2 sm:space-x-4">
                    <a href="#home" id="nav-home" class="nav-link px-4 py-2 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-200 transition-colors duration-200">Home</a>
                    <a href="#mri" id="nav-mri" class="nav-link px-4 py-2 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-200 transition-colors duration-200">MRI Analysis</a>
                    <a href="#voice" id="nav-voice" class="nav-link px-4 py-2 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-200 transition-colors duration-200">Voice Analysis</a>
                    <a href="#routine" id="nav-routine" class="nav-link px-4 py-2 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-200 transition-colors duration-200">Coping Routine</a>
                    <a href="#chat" id="nav-chat" class="nav-link px-4 py-2 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-200 transition-colors duration-200">Caregiver Chat</a>
                    <a href="#doctors" id="nav-doctors" class="nav-link px-4 py-2 rounded-lg text-base font-medium text-gray-700 hover:bg-gray-200 transition-colors duration-200">Doctors</a>
                </div>
            </div>
        </nav>
    </header>

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <!-- Home Section -->
        <section id="home-section" class="page-section">
             <main class="bg-white p-6 sm:p-8 rounded-xl shadow-lg text-center">
                <h1 class="text-4xl font-bold text-gray-900">Welcome to Memoria Diagnostics</h1>
                <p class="mt-4 text-lg text-gray-600">Your AI-powered assistant for preliminary Alzheimer's detection and daily support. Choose a tool below to get started.</p>
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <a href="#mri" class="nav-card block bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 text-left">
                        <div class="flex items-center">
                            <svg class="w-10 h-10 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                            <h2 class="ml-4 text-xl font-semibold text-gray-800">MRI Analysis</h2>
                        </div>
                        <p class="mt-2 text-gray-600">Analyze an MRI scan for potential structural signs of Alzheimer's disease.</p>
                    </a>
                    <a href="#voice" class="nav-card block bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 text-left">
                        <div class="flex items-center">
                            <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                            <h2 class="ml-4 text-xl font-semibold text-gray-800">Voice Analysis</h2>
                        </div>
                        <p class="mt-2 text-gray-600">Record your voice to analyze for potential linguistic markers.</p>
                    </a>
                    <a href="#routine" class="nav-card block bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 text-left">
                        <div class="flex items-center">
                            <svg class="w-10 h-10 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            <h2 class="ml-4 text-xl font-semibold text-gray-800">Coping Routine</h2>
                        </div>
                        <p class="mt-2 text-gray-600">View a suggested daily routine and generate new activity ideas to help manage symptoms.</p>
                    </a>
                    <a href="#chat" class="nav-card block bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 text-left">
                        <div class="flex items-center">
                            <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
                            <h2 class="ml-4 text-xl font-semibold text-gray-800">Caregiver Chat</h2>
                        </div>
                        <p class="mt-2 text-gray-600">Ask questions and get supportive advice from an AI assistant designed for caregivers.</p>
                    </a>
                </div>

                <!-- New Gemini Features for Home Page -->
                <div class="mt-12 pt-8 border-t-2 border-gray-200 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Daily Cognitive Boost -->
                    <div class="bg-blue-50 p-6 rounded-lg shadow-md text-left border border-blue-100">
                        <h2 class="text-xl font-semibold text-blue-700 mb-4 flex items-center">ðŸ§  Daily Cognitive Boost</h2>
                        <p class="text-gray-600 mb-4">Get a quick, positive tip or a simple activity idea to support cognitive well-being.</p>
                        <button id="generate-cognitive-boost-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 shadow-md">
                            Get a Boost!
                        </button>
                        <div id="cognitive-boost-loader" class="loader mx-auto my-4 hidden" style="width:20px; height:20px; border-top-color:#2563eb;"></div>
                        <div id="cognitive-boost-result" class="mt-4 p-3 rounded-md bg-blue-100 text-blue-800 border border-blue-200 hidden"></div>
                        <div id="cognitive-boost-error-message" class="mt-4 text-center text-red-500 font-medium hidden"></div>
                    </div>

                    <!-- Alzheimer's Insight of the Day -->
                    <div class="bg-green-50 p-6 rounded-lg shadow-md text-left border border-green-100">
                        <h2 class="text-xl font-semibold text-green-700 mb-4 flex items-center">ðŸ’¡ Alzheimer's Insight of the Day</h2>
                        <p class="text-gray-600 mb-4">Learn a new fact or clarify a common misconception about Alzheimer's disease.</p>
                        <button id="generate-alzheimers-insight-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 shadow-md">
                            Get an Insight!
                        </button>
                        <div id="alzheimers-insight-loader" class="loader mx-auto my-4 hidden" style="width:20px; height:20px; border-top-color:#16a34a;"></div>
                        <div id="alzheimers-insight-result" class="mt-4 p-3 rounded-md bg-green-100 text-green-800 border border-green-200 hidden"></div>
                        <div id="alzheimers-insight-error-message" class="mt-4 text-center text-red-500 font-medium hidden"></div>
                    </div>
                </div>
            </main>
        </section>

        <!-- MRI Analysis Section -->
        <section id="mri-section" class="page-section hidden">
            <main class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <header class="text-center mb-8">
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Brain MRI Alzheimer's Detection</h1>
                    <p class="text-md text-gray-600 mt-2">Upload a brain MRI scan to analyze for potential signs of Alzheimer's disease.</p>
                </header>
                <div class="upload-section text-center mb-6">
                    <label for="mri-upload" class="cursor-pointer inline-flex items-center bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-md">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        Upload MRI Scan
                    </label>
                    <input id="mri-upload" type="file" class="hidden" accept="image/png, image/jpeg, image/jpg">
                    <p id="file-name" class="text-sm text-gray-500 mt-3">No file selected</p>
                </div>
                <div id="image-preview" class="mt-6 text-center hidden">
                    <img id="preview" src="#" alt="MRI Scan Preview" class="max-w-full h-auto mx-auto rounded-lg shadow-md border border-gray-200">
                </div>
                <div class="text-center mt-8">
                    <button id="analyze-mri-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300 disabled:bg-gray-400 shadow-md" disabled>
                        Analyze MRI
                    </button>
                </div>
                <div id="mri-result-section" class="mt-10 hidden">
                    <h2 class="text-2xl font-semibold text-center mb-6 text-gray-900">MRI Analysis Result</h2>
                    <div id="mri-loader" class="loader mx-auto my-4 hidden"></div>
                    <div id="mri-result-text" class="bg-gray-50 p-6 rounded-lg text-gray-700 border border-gray-200"></div>
                </div>
                <div id="mri-error-message" class="mt-4 text-center text-red-500 font-medium hidden"></div>
            </main>
        </section>

        <!-- Voice Analysis Section -->
        <section id="voice-section" class="page-section hidden">
            <main class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <header class="text-center mb-8">
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Voice-Based Alzheimer's Detection</h1>
                    <p class="text-md text-gray-600 mt-2">Read the text aloud or upload a pre-recorded audio file to analyze for potential linguistic markers.</p>
                </header>

                <!-- Text to Read for Live Recording -->
                <div class="bg-gray-100 p-5 rounded-lg mb-6 border border-gray-200 shadow-inner">
                    <p id="text-to-read" class="text-lg text-gray-800 leading-relaxed italic">
                        "The house on the hill had a big garden with many colorful flowers. Every morning, the old man would walk his dog down the long, winding path to the river. He remembered a time when the river was full of fish."
                    </p>
                </div>

                <div class="flex flex-col items-center justify-center space-y-6 md:space-y-0 md:flex-row md:space-x-8 mb-6">
                    <!-- Live Recording Controls -->
                    <div class="flex items-center space-x-4">
                        <button id="start-record-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-md">
                            <svg class="w-5 h-5 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0 5 5 0 01-10 0 1 1 0 10-2 0 7.001 7.001 0 006 6.93V19h3v-2.07z" clip-rule="evenodd"></path></svg>
                            Start Recording
                        </button>
                        <button id="stop-record-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-md" disabled>
                            <svg class="w-5 h-5 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>
                            Stop Recording
                        </button>
                    </div>
                    
                    <div class="text-gray-400 text-xl font-semibold">OR</div>

                    <!-- File Upload Controls -->
                    <div class="upload-section text-center">
                        <label for="audio-upload" class="cursor-pointer inline-flex items-center bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-md">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            Upload Audio File
                        </label>
                        <input id="audio-upload" type="file" class="hidden" accept="audio/*">
                        <p id="audio-file-name" class="text-sm text-gray-500 mt-3">No file selected</p>
                    </div>
                </div>

                <!-- Audio Playback and Analysis Controls -->
                <div id="audio-playback-section" class="mt-6 text-center hidden">
                    <h3 class="text-lg font-medium text-gray-700 mb-2">Your Recording:</h3>
                    <audio id="audio-player" controls class="w-full max-w-lg mx-auto rounded-lg shadow-sm"></audio>
                </div>
                
                <div class="text-center mt-8">
                    <button id="analyze-voice-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300 disabled:bg-gray-400 shadow-md" disabled>
                        Analyze Voice
                    </button>
                </div>

                <!-- Analysis Results -->
                <div id="voice-result-section" class="mt-10 hidden">
                    <h2 class="text-2xl font-semibold text-center mb-6 text-gray-900">Voice Analysis Result</h2>
                    <div id="voice-loader" class="loader mx-auto my-4 hidden"></div>
                    <div id="voice-result-text" class="bg-gray-50 p-6 rounded-lg text-gray-700 border border-gray-200"></div>
                </div>
                <div id="voice-error-message" class="mt-4 text-center text-red-500 font-medium hidden"></div>
            </main>
        </section>

        <!-- Coping Routine Section -->
        <section id="routine-section" class="page-section hidden">
            <main class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <header class="text-center mb-8">
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Coping with Alzheimer's: A Daily Routine</h1>
                    <p class="text-md text-gray-600 mt-2">A structured daily routine can help reduce anxiety and maintain independence. This is a flexible guide; adapt it to individual needs and preferences.</p>
                </header>
                <div id="routine-container" class="space-y-8">
                    <div>
                        <h2 class="text-2xl font-semibold text-blue-600 border-b-2 border-blue-200 pb-2 mb-4">Morning Routine</h2>
                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 shadow-sm"><strong>Gentle Wake-Up:</strong> Allow for a calm and unhurried start to the day.</div>
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 shadow-sm"><strong>Personal Care:</strong> Assist with dressing and grooming as needed.</div>
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 shadow-sm"><strong>Healthy Breakfast:</strong> A nutritious, simple breakfast.</div>
                            <div id="morning-activity" class="bg-blue-50 p-4 rounded-lg border border-blue-100 shadow-sm"><strong>Light Activity:</strong> Simple chores like folding laundry.</div>
                        </div>
                        <div class="text-center mt-6">
                            <button class="generate-activity-btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors duration-300" data-time="morning">
                                âœ¨ Generate Morning Activity
                            </button>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-green-600 border-b-2 border-green-200 pb-2 mb-4">Afternoon Routine</h2>
                        <div class="space-y-4">
                            <div class="bg-green-50 p-4 rounded-lg border border-green-100 shadow-sm"><strong>Lunch:</strong> A balanced meal in a quiet environment.</div>
                            <div class="bg-green-50 p-4 rounded-lg border border-green-100 shadow-sm"><strong>Physical Activity:</strong> A short, guided walk or stretching.</div>
                            <div id="afternoon-activity" class="bg-green-50 p-4 rounded-lg border border-green-100 shadow-sm"><strong>Cognitive Stimulation:</strong> Look at photo albums or listen to music.</div>
                            <div class="bg-green-50 p-4 rounded-lg border border-green-100 shadow-sm"><strong>Quiet Time:</strong> A period for rest or a nap.</div>
                        </div>
                        <div class="text-center mt-6">
                            <button class="generate-activity-btn bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors duration-300" data-time="afternoon">
                                âœ¨ Generate Afternoon Activity
                            </button>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-purple-600 border-b-2 border-purple-200 pb-2 mb-4">Evening Routine</h2>
                        <div class="space-y-4">
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-100 shadow-sm"><strong>Dinner:</strong> A light, simple dinner.</div>
                            <div id="evening-activity" class="bg-purple-50 p-4 rounded-lg border border-purple-100 shadow-sm"><strong>Relaxation:</strong> Listen to calming music or an audiobook.</div>
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-100 shadow-sm"><strong>Prepare for Bed:</strong> A consistent bedtime routine.</div>
                            <div class="bg-purple-50 p-4 rounded-lg border border-purple-100 shadow-sm"><strong>Safety Check:</strong> Ensure the environment is safe for the night.</div>
                        </div>
                        <div class="text-center mt-6">
                            <button class="generate-activity-btn bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors duration-300" data-time="evening">
                                âœ¨ Generate Evening Activity
                            </button>
                        </div>
                    </div>
                </div>
                <div id="routine-error-message" class="mt-6 text-center text-red-500 font-medium hidden"></div>
            </main>
        </section>

        <!-- Caregiver Chat Section -->
        <section id="chat-section" class="page-section hidden">
            <main class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <header class="text-center mb-8">
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">âœ¨ Caregiver Support Chat</h1>
                    <p class="text-md text-gray-600 mt-2">Ask questions about caregiving, managing symptoms, get personalized coping routine or for supportive advice. I'm here to help.</p>
                </header>
                <div id="chat-window" class="bg-gray-50 border rounded-lg p-4 space-y-4 shadow-inner">
                    <!-- Chat messages will appear here -->
                </div>
                <form id="chat-form" class="mt-4 flex">
                    <input type="text" id="chat-input" class="flex-grow border border-gray-300 rounded-l-lg p-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" placeholder="Type your message..." autocomplete="off">
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-r-lg shadow-md transition-colors duration-300">
                        Send
                    </button>
                </form>
                <div id="chat-error-message" class="mt-4 text-center text-red-500 font-medium hidden"></div>
            </main>
        </section>

        <!-- Doctors Section -->
        <section id="doctors-section" class="page-section hidden">
            <main class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <header class="text-center mb-8">
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Alzheimer's and Dementia Specialists</h1>
                    <p class="text-md text-gray-600 mt-2">Select a city to find doctors with explicit specialization in Alzheimer's and related dementias.</p>
                </header>
                <div class="mb-6 flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <label for="city-select" class="font-medium text-gray-700">Choose a City:</label>
                    <select id="city-select" class="block w-full sm:w-auto p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                        <option value="Chennai">Chennai</option>
                        <option value="Bangalore">Bangalore</option>
                        <option value="Mumbai">Mumbai</option>
                        <option value="New Delhi">New Delhi</option>
                        <option value="Kolkata">Kolkata</option>
                        <option value="Hyderabad">Hyderabad</option>
                        <option value="Pune">Pune</option>
                        <option value="Ahmedabad">Ahmedabad</option>
                        <option value="Jaipur">Jaipur</option>
                        <option value="Lucknow">Lucknow</option>
                        <option value="Surat">Surat</option>
                        <option value="Patna">Patna</option>
                        <option value="Bhubaneswar">Bhubaneswar</option>
                        <option value="Nagpur">Nagpur</option>
                        <option value="Coimbatore">Coimbatore</option>
                        <option value="Indore">Indore</option>
                        <option value="Chandigarh">Chandigarh</option>
                    </select>
                </div>
                <div id="doctors-list" class="space-y-6">
                    <!-- Doctors will be dynamically inserted here -->
                </div>
            </main>
        </section>

        <footer class="text-center text-sm text-gray-500 mt-8 py-4">
            <p>Disclaimer: This tool is for informational purposes only and does not provide a medical diagnosis. Consult with a qualified healthcare professional for any health concerns.</p>
        </footer>
    </div>

    <script>
        // --- Common Variables ---
        // IMPORTANT: Replace with your actual Gemini API Key if deploying
        const apiKey = "AIzaSyBj4nDn-czNrrnJd3vTJh2tYi_vMY_gAyc"; 

        // --- Navigation Elements ---
        const navHome = document.getElementById('nav-home');
        const navMri = document.getElementById('nav-mri');
        const navVoice = document.getElementById('nav-voice');
        const navRoutine = document.getElementById('nav-routine');
        const navChat = document.getElementById('nav-chat');
        const navDoctors = document.getElementById('nav-doctors');
        const homeSection = document.getElementById('home-section');
        const mriSection = document.getElementById('mri-section');
        const voiceSection = document.getElementById('voice-section');
        const routineSection = document.getElementById('routine-section');
        const chatSection = document.getElementById('chat-section');
        const doctorsSection = document.getElementById('doctors-section');
        const navCards = document.querySelectorAll('.nav-card');

        // --- MRI Section Elements ---
        const mriUpload = document.getElementById('mri-upload');
        const fileName = document.getElementById('file-name');
        const imagePreview = document.getElementById('image-preview');
        const preview = document.getElementById('preview');
        const analyzeMriBtn = document.getElementById('analyze-mri-btn');
        const mriResultSection = document.getElementById('mri-result-section');
        const mriLoader = document.getElementById('mri-loader');
        const mriResultText = document.getElementById('mri-result-text');
        const mriErrorMessage = document.getElementById('mri-error-message');
        let mriImageData = { base64: null, mimeType: null };

        // --- Voice Section Elements ---
        const startRecordBtn = document.getElementById('start-record-btn');
        const stopRecordBtn = document.getElementById('stop-record-btn');
        const audioPlaybackSection = document.getElementById('audio-playback-section');
        const audioPlayer = document.getElementById('audio-player');
        const analyzeVoiceBtn = document.getElementById('analyze-voice-btn');
        const voiceResultSection = document.getElementById('voice-result-section');
        const voiceLoader = document.getElementById('voice-loader');
        const voiceResultText = document.getElementById('voice-result-text');
        const voiceErrorMessage = document.getElementById('voice-error-message');
        const textToRead = document.getElementById('text-to-read').textContent;
        const audioUpload = document.getElementById('audio-upload');
        const audioFileName = document.getElementById('audio-file-name');
        let mediaRecorder;
        let audioChunks = [];
        let uploadedAudioData = { base64: null, mimeType: null };
        let recordedAudioData = { base64: null, mimeType: null };

        // --- Routine Section Elements ---
        const generateActivityBtns = document.querySelectorAll('.generate-activity-btn');
        const routineErrorMessage = document.getElementById('routine-error-message');

        // --- Chat Section Elements ---
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatWindow = document.getElementById('chat-window');
        const chatErrorMessage = document.getElementById('chat-error-message');
        let chatHistory = [];

        // --- New Home Page Gemini Feature Elements ---
        const generateCognitiveBoostBtn = document.getElementById('generate-cognitive-boost-btn');
        const cognitiveBoostLoader = document.getElementById('cognitive-boost-loader');
        const cognitiveBoostResult = document.getElementById('cognitive-boost-result');
        const cognitiveBoostErrorMessage = document.getElementById('cognitive-boost-error-message');

        const generateAlzheimersInsightBtn = document.getElementById('generate-alzheimers-insight-btn');
        const alzheimersInsightLoader = document.getElementById('alzheimers-insight-loader');
        const alzheimersInsightResult = document.getElementById('alzheimers-insight-result');
        const alzheimersInsightErrorMessage = document.getElementById('alzheimers-insight-error-message');

        // --- Doctors Section Elements ---
        const citySelect = document.getElementById('city-select');
        const doctorsList = document.getElementById('doctors-list');
        
        // --- Doctors Data ---
        const doctorsData = {
            'Chennai': [
                { name: 'Dr. Philo Hazeena', experience: '17 years', affiliation: 'Dr K P Thirumarans Speciality Clinic / Sri Ramachandra Medical Centre', specialization: 'Dementia Treatment, Alzheimer\'s Disease', location: 'T Nagar, Chennai' },
                { name: 'Dr. S Dinesh Nayak', experience: '22 years', affiliation: 'Gleneagles Global Hospital', specialization: 'Alzheimer\'s Disease Treatment', location: 'Perumbakkam, Chennai' },
                { name: 'Dr. K Bhanu', experience: '27 years', affiliation: 'Dr Mehta\'s Hospital', specialization: 'Treatment of Forgetfulness', location: 'Chennai' },
                { name: 'Dr. Prithika Chary', experience: 'Not specified', affiliation: 'Kauvery Hospital', specialization: 'Dementia treatment', location: 'Chennai' },
                { name: 'Dr. Somesh Vanchilingam', experience: 'Not specified', affiliation: 'Dr. Vanchilingam Hospital', specialization: 'Alzheimer\'s Treatment Specialist', location: 'Chennai & Thanjavur' },
                { name: 'Dr. K. Sushmitha', experience: 'Not specified', affiliation: 'Kauvery Hospital', specialization: 'Geriatrics, Cognition Assessment, Dementia Management', location: 'Chennai-Alwarpet' },
                { name: 'Dr. K. Vasanth', experience: '8+ years', affiliation: 'Geri Care', specialization: 'Geriatrics, Dementia care, Homecare', location: 'Adyar & Adambakkam (OP), Home Visits' },
                { name: 'Dr. N. Lakshmipathy Ramesh', experience: '20+ years', affiliation: 'Geri Care', specialization: 'Geriatrics, Dementia care', location: 'T. Nagar, Adambakkam, Adyar' },
                { name: 'Dr. V S Natrajan', experience: 'Not specified', affiliation: 'Adhiparasakth Clinic / Memory Clinic', specialization: 'Memory Clinic, Dementia', location: 'Kilpauk, Chennai' },
                { name: 'Dr. S Balasubramaniam', experience: '23 years', affiliation: 'Be Well Hospital / The Apollo Clinic', specialization: 'Alzheimer\'s disease (listed by Justdial)', location: 'T Nagar, Velacheri' }
            ],
            'Bangalore': [
                { name: 'Dr. T. L. N. Prasanthi', experience: '15 years', affiliation: 'Manipal Hospital', specialization: 'Dementia, Epilepsy, Stroke', location: 'Bangalore' },
                { name: 'Dr. Murali Mohan B V', experience: '16 years', affiliation: 'Manipal Hospital', specialization: 'Dementia, Parkinson\'s Disease, Stroke', location: 'Bangalore' },
                { name: 'Dr. Madhusudhan B K', experience: '10 years', affiliation: 'Ayu Health Hospital', specialization: 'Memory loss, Alzheimer\'s, Parkinson\'s disease', location: 'Bangalore' },
                { name: 'Dr. Prashanth M. P.', experience: '18 years', affiliation: 'Saket Hospital', specialization: 'Dementia, Neurological Problems', location: 'Bangalore' },
                { name: 'Dr. Shobha N', experience: '20 years', affiliation: 'SSNMC Super Speciality Hospital', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Bangalore' },
                { name: 'Dr. H N Dinesh', experience: '17 years', affiliation: 'Yashomati Hospitals', specialization: 'Dementia, Stroke, Multiple Sclerosis', location: 'Bangalore' },
                { name: 'Dr. Naveen Kumar N', experience: '11 years', affiliation: 'Sagar Hospitals', specialization: 'Dementia, Neurological problems', location: 'Bangalore' },
                { name: 'Dr. Anbu T R', experience: '20 years', affiliation: 'BGS Gleneagles Global Hospitals', specialization: 'Dementia, Epilepsy, Stroke', location: 'Bangalore' },
                { name: 'Dr. Sreenivasachar', experience: '15 years', affiliation: 'Aster CMI Hospital', specialization: 'Dementia, Epilepsy, Parkinson\'s Disease', location: 'Bangalore' },
                { name: 'Dr. S. K. Acharaya', experience: '30 years', affiliation: 'Apollo Hospital', specialization: 'Alzheimer\'s, Parkinson\'s, Epilepsy', location: 'Bangalore' }
            ],
            'Mumbai': [
                { name: 'Dr. Sangeeta Rao', experience: '25 years', affiliation: 'Sir H. N. Reliance Foundation Hospital and Research Centre', specialization: 'Dementia, Alzheimer\'s, Memory Disorders', location: 'Mumbai' },
                { name: 'Dr. M. D. Wadia', experience: '45 years', affiliation: 'Jaslok Hospital', specialization: 'Dementia, Parkinson\'s, Headaches', location: 'Mumbai' },
                { name: 'Dr. Pooja Salvi', experience: '15 years', affiliation: 'Kokilaben Dhirubhai Ambani Hospital', specialization: 'Dementia, Epilepsy, Stroke', location: 'Mumbai' },
                { name: 'Dr. G. K. Pradeep', experience: '18 years', affiliation: 'Lilavati Hospital', specialization: 'Dementia, Alzheimer\'s, Multiple Sclerosis', location: 'Mumbai' },
                { name: 'Dr. Rajesh B.', experience: '20 years', affiliation: 'Apollo Hospital', specialization: 'Dementia, Epilepsy, Neurological problems', location: 'Mumbai' },
                { name: 'Dr. Pradeep Nair', experience: '17 years', affiliation: 'Fortis Hospital', specialization: 'Dementia, Parkinson\'s, Stroke', location: 'Mumbai' },
                { name: 'Dr. Anand Kumar', experience: '10 years', affiliation: 'Wockhardt Hospital', specialization: 'Memory loss, Alzheimer\'s, Epilepsy', location: 'Mumbai' },
                { name: 'Dr. Sanjay Singh', experience: '12 years', affiliation: 'Nanavati Super Speciality Hospital', specialization: 'Dementia, Neuromuscular disorders', location: 'Mumbai' },
                { name: 'Dr. K. N. Sumanth', experience: '22 years', affiliation: 'Saifee Hospital', specialization: 'Dementia, Alzheimer\'s, Migraine', location: 'Mumbai' },
                { name: 'Dr. Ajay Verma', experience: '15 years', affiliation: 'Bhatia Hospital', specialization: 'Dementia, Neurological disorders', location: 'Mumbai' }
            ],
            'New Delhi': [
                { name: 'Dr. P. S. Bindra', experience: '30 years', affiliation: 'Max Healthcare', specialization: 'Dementia, Stroke, Epilepsy', location: 'New Delhi' },
                { name: 'Dr. Atul Prasad', experience: '25 years', affiliation: 'Artemis Hospital', specialization: 'Dementia, Alzheimer\'s, Parkinson\'s', location: 'New Delhi' },
                { name: 'Dr. Manjeet Kumar', experience: '18 years', affiliation: 'Fortis Hospital', specialization: 'Dementia, Memory Loss, Neuro-rehabilitation', location: 'New Delhi' },
                { name: 'Dr. M. S. Kumar', experience: '15 years', affiliation: 'Indraprastha Apollo Hospital', specialization: 'Dementia, Alzheimer\'s, Multiple Sclerosis', location: 'New Delhi' },
                { name: 'Dr. Praveen Gupta', experience: '20 years', affiliation: 'Fortis Memorial Research Institute', specialization: 'Dementia, Epilepsy, Movement Disorders', location: 'New Delhi' },
                { name: 'Dr. Usha B. Nair', experience: '22 years', affiliation: 'Max Healthcare', specialization: 'Dementia, Alzheimer\'s, Headaches', location: 'New Delhi' },
                { name: 'Dr. Arun Garg', experience: '10 years', affiliation: 'Yashoda Hospital', specialization: 'Dementia, Stroke, Epilepsy', location: 'New Delhi' },
                { name: 'Dr. Rahul Varma', experience: '12 years', affiliation: 'Moolchand Hospital', specialization: 'Dementia, Alzheimer\'s, Memory disorders', location: 'New Delhi' },
                { name: 'Dr. B. K. Singh', experience: '15 years', affiliation: 'AIIMS', specialization: 'Dementia, Neurological disorders', location: 'New Delhi' },
                { name: 'Dr. Sanjay Dhawan', experience: '17 years', affiliation: 'Vimhans Nayati Superspecialty Hospital', specialization: 'Dementia, Alzheimer\'s, Brain injury', location: 'New Delhi' }
            ],
            'Kolkata': [
                { name: 'Dr. Tapan Kumar Mandal', experience: '18 years', affiliation: 'Apollo Gleneagles Hospital', specialization: 'Dementia, Epilepsy, Stroke', location: 'Kolkata' },
                { name: 'Dr. Joydeep Ghosh', experience: '20 years', affiliation: 'AMRI Hospitals', specialization: 'Dementia, Parkinson\'s, Memory Disorders', location: 'Kolkata' },
                { name: 'Dr. Supriyo Choudhury', experience: '15 years', affiliation: 'Medica Superspecialty Hospital', specialization: 'Alzheimer\'s, Migraine, Stroke', location: 'Kolkata' },
                { name: 'Dr. Sandeep Singh', experience: '12 years', affiliation: 'Manipal Hospital', specialization: 'Dementia Care, Neurological Disorders', location: 'Kolkata' },
                { name: 'Dr. S. N. Sinha', experience: '25 years', affiliation: 'Fortis Hospital', specialization: 'Dementia, Neurophysiology, Stroke', location: 'Kolkata' },
                { name: 'Dr. Tarun Kumar Pal', experience: '17 years', affiliation: 'Peerless Hospital', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Kolkata' },
                { name: 'Dr. Sanjay Kumar', experience: '19 years', affiliation: 'Narayan Memorial Hospital', specialization: 'Dementia, Memory Loss, Stroke', location: 'Kolkata' },
                { name: 'Dr. Sudipto Das', experience: '14 years', affiliation: 'Desun Hospital', specialization: 'Dementia, Parkinson\'s, Multiple Sclerosis', location: 'Kolkata' },
                { name: 'Dr. Dipanjan Ray', experience: '10 years', affiliation: 'Kothari Medical Centre', specialization: 'Dementia, Neurological Problems', location: 'Kolkata' },
                { name: 'Dr. Indrani Bhattacharya', experience: '21 years', affiliation: 'Fortis Hospital', specialization: 'Dementia, Alzheimer\'s, Headache', location: 'Kolkata' }
            ],
            'Hyderabad': [
                { name: 'Dr. Sunil Kumar', experience: '20 years', affiliation: 'Apollo Hospitals', specialization: 'Dementia, Neurological problems, Stroke', location: 'Hyderabad' },
                { name: 'Dr. S. K. Acharaya', experience: '25 years', affiliation: 'Continental Hospitals', specialization: 'Alzheimer\'s, Parkinson\'s, Epilepsy', location: 'Hyderabad' },
                { name: 'Dr. Praveen Kumar', experience: '15 years', affiliation: 'MaxCure Hospitals', specialization: 'Dementia, Memory Loss, Neuro-rehabilitation', location: 'Hyderabad' },
                { name: 'Dr. Ananda Kumar', experience: '18 years', affiliation: 'Yashoda Hospitals', specialization: 'Dementia, Epilepsy, Stroke', location: 'Hyderabad' },
                { name: 'Dr. V. B. S. Raman', experience: '22 years', affiliation: 'KIMS Hospitals', specialization: 'Dementia, Parkinson\'s, Neuro-ophthalmology', location: 'Hyderabad' },
                { name: 'Dr. P. S. Reddy', experience: '16 years', affiliation: 'Asian Institute of Gastroenterology', specialization: 'Dementia, Neurological Disorders', location: 'Hyderabad' },
                { name: 'Dr. G. K. Reddy', experience: '19 years', affiliation: 'Star Hospitals', specialization: 'Dementia, Alzheimer\'s, Headaches', location: 'Hyderabad' },
                { name: 'Dr. Vikram Kumar', experience: '14 years', affiliation: 'AIG Hospitals', specialization: 'Dementia, Movement Disorders', location: 'Hyderabad' },
                { name: 'Dr. R. R. Sharma', experience: '21 years', affiliation: 'Apollo Hospitals', specialization: 'Dementia, Neuro-oncology, Stroke', location: 'Hyderabad' },
                { name: 'Dr. Sandhya', experience: '10 years', affiliation: 'Care Hospitals', specialization: 'Dementia, Neurological problems', location: 'Hyderabad' }
            ],
            'Pune': [
                { name: 'Dr. Sandeep Singh', experience: '22 years', affiliation: 'Jehangir Hospital', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Pune' },
                { name: 'Dr. Pratik Tamboli', experience: '16 years', affiliation: 'Sahyadri Hospital', specialization: 'Dementia, Neuromuscular disorders, Stroke', location: 'Pune' },
                { name: 'Dr. Rahul Soni', experience: '19 years', affiliation: 'Ruby Hall Clinic', specialization: 'Dementia, Memory disorders, Parkinson\'s', location: 'Pune' },
                { name: 'Dr. Sachin Varma', experience: '15 years', affiliation: 'Jupiter Hospital', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Pune' },
                { name: 'Dr. Mahesh H S', experience: '17 years', affiliation: 'Columbia Asia Hospital', specialization: 'Dementia, Epilepsy, Stroke', location: 'Pune' },
                { name: 'Dr. N. K. Sharma', experience: '20 years', affiliation: 'Aditya Birla Memorial Hospital', specialization: 'Dementia, Neurological problems', location: 'Pune' },
                { name: 'Dr. A. S. Bhatia', experience: '25 years', affiliation: 'Deenanath Mangeshkar Hospital', specialization: 'Dementia, Alzheimer\'s, Headache', location: 'Pune' },
                { name: 'Dr. R. M. Kale', experience: '14 years', affiliation: 'Inamdar Multispeciality Hospital', specialization: 'Dementia, Movement Disorders', location: 'Pune' },
                { name: 'Dr. Sneha Awasthi', experience: '11 years', affiliation: 'Noble Hospital', specialization: 'Dementia, Neurological disorders', location: 'Pune' },
                { name: 'Dr. Anupama Kumar', experience: '13 years', affiliation: 'Sancheti Hospital', specialization: 'Dementia, Stroke, Epilepsy', location: 'Pune' }
            ],
            'Ahmedabad': [
                { name: 'Dr. Sudhir Shah', experience: '35+ years', affiliation: 'Sterling Hospital', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Ahmedabad' },
                { name: 'Dr. Hiren Panchal', experience: '15 years', affiliation: 'Apollo Hospitals', specialization: 'Dementia, Epilepsy, Stroke', location: 'Ahmedabad' },
                { name: 'Dr. Parag B. Shah', experience: '20+ years', affiliation: 'Zydus Hospitals', specialization: 'Dementia, Parkinson\'s, Movement Disorders', location: 'Ahmedabad' },
                { name: 'Dr. Ketan Patel', experience: '18 years', affiliation: 'CIMS Hospital', specialization: 'Dementia, Headache, Neurological problems', location: 'Ahmedabad' },
                { name: 'Dr. Manish J. Gandhi', experience: '25+ years', affiliation: 'KD Hospital', specialization: 'Dementia, Alzheimer\'s, Neurological disorders', location: 'Ahmedabad' },
                { name: 'Dr. Vipul J. Shah', experience: '12 years', affiliation: 'HCG Hospitals', specialization: 'Dementia, Stroke, Epilepsy', location: 'Ahmedabad' },
                { name: 'Dr. Milan J. Jani', experience: '16 years', affiliation: 'SAL Hospital', specialization: 'Dementia, Memory loss, Neuro-rehabilitation', location: 'Ahmedabad' },
                { name: 'Dr. Rakesh Shah', experience: '19 years', affiliation: 'Rajasthan Hospitals', specialization: 'Dementia, Parkinson\'s, Neuromuscular disorders', location: 'Ahmedabad' },
                { name: 'Dr. Paresh J. Desai', experience: '10 years', affiliation: 'Sola Civil Hospital', specialization: 'Dementia, Alzheimer\'s, Migraine', location: 'Ahmedabad' },
                { name: 'Dr. Apoorva Joshi', experience: '14 years', affiliation: 'Global Hospital', specialization: 'Dementia, Neurological problems', location: 'Ahmedabad' }
            ],
            'Jaipur': [
                { name: 'Dr. Vijay K. Singh', experience: '25 years', affiliation: 'Fortis Escorts Hospital', specialization: 'Dementia, Parkinson\'s, Headache', location: 'Jaipur' },
                { name: 'Dr. Anil Saxena', experience: '20+ years', affiliation: 'Manipal Hospitals', specialization: 'Dementia, Alzheimer\'s, Neurological disorders', location: 'Jaipur' },
                { name: 'Dr. Sudhir Sharma', experience: '18 years', affiliation: 'SMS Medical College', specialization: 'Dementia, Epilepsy, Stroke', location: 'Jaipur' },
                { name: 'Dr. Nitin Sethi', experience: '15 years', affiliation: 'Apex Hospital', specialization: 'Dementia, Neuromuscular disorders, Headache', location: 'Jaipur' },
                { name: 'Dr. Mukesh S.', experience: '22 years', affiliation: 'EHCC Hospital', specialization: 'Dementia, Parkinson\'s, Multiple Sclerosis', location: 'Jaipur' },
                { name: 'Dr. Deepak Goyal', experience: '17 years', affiliation: 'Narayan Hospital', specialization: 'Dementia, Memory loss, Neuro-rehabilitation', location: 'Jaipur' },
                { name: 'Dr. Rakesh Singh', experience: '14 years', affiliation: 'Monilek Hospital', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Jaipur' },
                { name: 'Dr. Apoorva Sharma', experience: '10 years', affiliation: 'Soni Hospital', specialization: 'Dementia, Stroke, Neurological problems', location: 'Jaipur' },
                { name: 'Dr. P. L. Gupta', experience: '30+ years', affiliation: 'Mahatma Gandhi Hospital', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Jaipur' },
                { name: 'Dr. B. L. Meena', experience: '16 years', affiliation: 'Fortis Hospital', specialization: 'Dementia, Headache, Migraine', location: 'Jaipur' }
            ],
            'Lucknow': [
                { name: 'Dr. Sanjay Gupta', experience: '20+ years', affiliation: 'Sanjay Gandhi Postgraduate Institute of Medical Sciences (SGPGIMS)', specialization: 'Dementia, Epilepsy, Stroke', location: 'Lucknow' },
                { name: 'Dr. Sandeep Singh', experience: '15 years', affiliation: 'Apollo Hospitals', specialization: 'Dementia, Parkinson\'s, Movement Disorders', location: 'Lucknow' },
                { name: 'Dr. P. K. Srivastava', experience: '25+ years', affiliation: 'King George\'s Medical University (KGMU)', specialization: 'Dementia, Alzheimer\'s, Neurological disorders', location: 'Lucknow' },
                { name: 'Dr. Alok Singh', experience: '18 years', affiliation: 'Medanta Hospital', specialization: 'Dementia, Migraine, Epilepsy', location: 'Lucknow' },
                { name: 'Dr. R. K. Singh', experience: '16 years', affiliation: 'Era\'s Lucknow Medical College', specialization: 'Dementia, Memory Loss, Stroke', location: 'Lucknow' },
                { name: 'Dr. Vijay K. Singh', experience: '10 years', affiliation: 'Sahara Hospital', specialization: 'Dementia, Alzheimer\'s, Headache', location: 'Lucknow' },
                { name: 'Dr. Vimal Kumar', experience: '12 years', affiliation: 'Charak Hospital', specialization: 'Dementia, Parkinson\'s, Neuromuscular disorders', location: 'Lucknow' },
                { name: 'Dr. Anurag Dixit', experience: '14 years', affiliation: 'Mayo Hospital', specialization: 'Dementia, Stroke, Neuro-rehabilitation', location: 'Lucknow' },
                { name: 'Dr. B. K. Singh', experience: '17 years', affiliation: 'Vivekanand Hospital', specialization: 'Dementia, Neurological problems', location: 'Lucknow' },
                { name: 'Dr. S. C. Mishra', experience: '30+ years', affiliation: 'SGPGI', specialization: 'Dementia, Alzheimer\'s, Neuromuscular disorders', location: 'Lucknow' }
            ],
            'Surat': [
                { name: 'Dr. Harshit Prajapati', experience: '15 years', affiliation: 'Apollo Hospital', specialization: 'Dementia, Parkinson\'s, Epilepsy', location: 'Surat' },
                { name: 'Dr. Pranav Shah', experience: '20+ years', affiliation: 'Mahavir Hospital', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Surat' },
                { name: 'Dr. Sachin Patel', experience: '18 years', affiliation: 'New Civil Hospital', specialization: 'Dementia, Stroke, Headache', location: 'Surat' },
                { name: 'Dr. Ketan Chudasama', experience: '12 years', affiliation: 'Ashutosh Multi Speciality Hospital', specialization: 'Dementia, Migraine, Neurological problems', location: 'Surat' },
                { name: 'Dr. Jignesh K. Shah', experience: '16 years', affiliation: 'SMIMER Hospital', specialization: 'Dementia, Memory loss, Stroke', location: 'Surat' },
                { name: 'Dr. Tushar P. Patel', experience: '14 years', affiliation: 'Sanajy Hospital', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Surat' },
                { name: 'Dr. Alpesh V. Patel', experience: '10 years', affiliation: 'Unique Hospital', specialization: 'Dementia, Parkinson\'s, Neuromuscular disorders', location: 'Surat' },
                { name: 'Dr. Hardik Patel', experience: '11 years', affiliation: 'Shanti Hospital', specialization: 'Dementia, Neuro-rehabilitation', location: 'Surat' },
                { name: 'Dr. S. K. Prajapati', experience: '25+ years', affiliation: 'Apple Hospital', specialization: 'Dementia, Alzheimer\'s, Neurological disorders', location: 'Surat' },
                { name: 'Dr. V. J. Vaghela', experience: '17 years', affiliation: 'Metas Adventist Hospital', specialization: 'Dementia, Stroke, Multiple Sclerosis', location: 'Surat' }
            ],
            'Patna': [
                { name: 'Dr. T. P. Jha', experience: '25 years', affiliation: 'Paras HMRI Hospital', specialization: 'Dementia, Parkinson\'s, Epilepsy', location: 'Patna' },
                { name: 'Dr. Manoj Kumar', experience: '20 years', affiliation: 'IGIMS Hospital', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Patna' },
                { name: 'Dr. B. K. Singh', experience: '18 years', affiliation: 'Indraprastha Apollo Hospitals', specialization: 'Dementia, Stroke, Headache', location: 'Patna' },
                { name: 'Dr. Sanjeev Kumar', experience: '15 years', affiliation: 'Ford Hospital', specialization: 'Dementia, Migraine, Neurological problems', location: 'Patna' },
                { name: 'Dr. S. K. Singh', experience: '16 years', affiliation: 'Sanjeevani Hospital', specialization: 'Dementia, Memory loss, Stroke', location: 'Patna' },
                { name: 'Dr. M. P. Singh', experience: '14 years', affiliation: 'Mahavir Vatsalya Aspatal', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Patna' },
                { name: 'Dr. P. K. Singh', experience: '10 years', affiliation: 'AIIMS Patna', specialization: 'Dementia, Parkinson\'s, Neuromuscular disorders', location: 'Patna' },
                { name: 'Dr. R. K. Singh', experience: '11 years', affiliation: 'Ruban Memorial Hospital', specialization: 'Dementia, Neuro-rehabilitation', location: 'Patna' },
                { name: 'Dr. A. K. Singh', experience: '17 years', affiliation: 'K. G. Eye Hospital', specialization: 'Dementia, Neurological problems', location: 'Patna' },
                { name: 'Dr. D. K. Singh', experience: '19 years', affiliation: 'Sunita Hospital', specialization: 'Dementia, Stroke, Multiple Sclerosis', location: 'Patna' }
            ],
            'Bhubaneswar': [
                { name: 'Dr. A. P. Mishra', experience: '20+ years', affiliation: 'Apollo Hospitals', specialization: 'Dementia, Parkinson\'s, Epilepsy', location: 'Bhubaneswar' },
                { name: 'Dr. S. R. Sahoo', experience: '18 years', affiliation: 'AIIMS Bhubaneswar', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Bhubaneswar' },
                { name: 'Dr. A. C. Dash', experience: '15 years', affiliation: 'Kalinga Hospital', specialization: 'Dementia, Stroke, Headache', location: 'Bhubaneswar' },
                { name: 'Dr. A. K. Mishra', experience: '12 years', affiliation: 'SUM Hospital', specialization: 'Dementia, Migraine, Neurological problems', location: 'Bhubaneswar' },
                { name: 'Dr. S. K. Sahoo', experience: '16 years', affiliation: 'Hi-Tech Medical College & Hospital', specialization: 'Dementia, Memory loss, Stroke', location: 'Bhubaneswar' },
                { name: 'Dr. J. P. Das', experience: '14 years', affiliation: 'IMS & SUM Hospital', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Bhubaneswar' },
                { name: 'Dr. R. K. Tripathy', experience: '10 years', affiliation: 'KIIMS Hospital', specialization: 'Dementia, Parkinson\'s, Neuromuscular disorders', location: 'Bhubaneswar' },
                { name: 'Dr. M. K. Behera', experience: '11 years', affiliation: 'Nilachal Hospital', specialization: 'Dementia, Neuro-rehabilitation', location: 'Bhubaneswar' },
                { name: 'Dr. R. K. Singh', experience: '17 years', affiliation: 'Sunshine Hospital', specialization: 'Dementia, Neurological problems', location: 'Bhubaneswar' },
                { name: 'Dr. B. K. Das', experience: '19 years', affiliation: 'Care Hospitals', specialization: 'Dementia, Stroke, Multiple Sclerosis', location: 'Bhubaneswar' }
            ],
            'Nagpur': [
                { name: 'Dr. Rajesh V. Patil', experience: '25 years', affiliation: 'Wockhardt Hospital', specialization: 'Dementia, Parkinson\'s, Epilepsy', location: 'Nagpur' },
                { name: 'Dr. M. S. Wankhade', experience: '20 years', affiliation: 'AIIMS Nagpur', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Nagpur' },
                { name: 'Dr. Chandrashekhar Meshram', experience: '30+ years', affiliation: 'Seven Star Hospital', specialization: 'Dementia, Stroke, Headache', location: 'Nagpur' },
                { name: 'Dr. Nitin K. Kedia', experience: '15 years', affiliation: 'Kingsway Hospitals', specialization: 'Dementia, Migraine, Neurological problems', location: 'Nagpur' },
                { name: 'Dr. B. J. Waghmare', experience: '16 years', affiliation: 'Central India Institute of Medical Sciences (CIIMS)', specialization: 'Dementia, Memory loss, Stroke', location: 'Nagpur' },
                { name: 'Dr. Vasant M. Vani', experience: '14 years', affiliation: 'Getwell Hospital', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Nagpur' },
                { name: 'Dr. Ajay M. Saraf', experience: '10 years', affiliation: 'Apollo Clinic', specialization: 'Dementia, Parkinson\'s, Neuromuscular disorders', location: 'Nagpur' },
                { name: 'Dr. Sameer V. Bais', experience: '11 years', affiliation: 'Neuron Hospital', specialization: 'Dementia, Neuro-rehabilitation', location: 'Nagpur' },
                { name: 'Dr. P. S. Nagpure', experience: '17 years', affiliation: 'Care Hospital', specialization: 'Dementia, Neurological problems', location: 'Nagpur' },
                { name: 'Dr. A. S. Thakre', experience: '19 years', affiliation: 'Orange City Hospital & Research Institute', specialization: 'Dementia, Stroke, Multiple Sclerosis', location: 'Nagpur' }
            ],
            'Coimbatore': [
                { name: 'Dr. K. N. Sumanth', experience: '22 years', affiliation: 'Saifee Hospital', specialization: 'Dementia, Alzheimer\'s, Migraine', location: 'Coimbatore' },
                { name: 'Dr. Arul A S. Babu', experience: 'Not specified', affiliation: 'Dr. Vanchilingam Hospital', specialization: 'Neuro & Vascular Interventional Radiologist', location: 'Coimbatore' },
                { name: 'Dr. Bhuvaneshwari Rajendran', experience: '15 years', affiliation: 'SIMS Hospital', specialization: 'Epilepsy treatment, Neurophysiology, Stroke treatment', location: 'Coimbatore' },
                { name: 'Dr. G. Balamurali', experience: '26 years', affiliation: 'Kauvery Hospital', specialization: 'Spine Surgery, Minimally Invasive Spine Surgery', location: 'Coimbatore' },
                { name: 'Dr. S. K. Acharaya', experience: '30 years', affiliation: 'Apollo Hospital', specialization: 'Alzheimer\'s, Parkinson\'s, Epilepsy', location: 'Coimbatore' },
                { name: 'Dr. Arun Garg', experience: '10 years', affiliation: 'Ganga Hospital', specialization: 'Dementia, Stroke, Epilepsy', location: 'Coimbatore' },
                { name: 'Dr. P. Muthukumar', experience: '20 years', affiliation: 'Kovai Medical Center and Hospital', specialization: 'General Neurology', location: 'Coimbatore' },
                { name: 'Dr. V. B. S. Raman', experience: '22 years', affiliation: 'Sri Ramakrishna Hospital', specialization: 'Dementia, Parkinson\'s, Neuro-ophthalmology', location: 'Coimbatore' },
                { name: 'Dr. R. R. Sharma', experience: '21 years', affiliation: 'GEM Hospital', specialization: 'Dementia, Neuro-oncology, Stroke', location: 'Coimbatore' },
                { name: 'Dr. Anupama Kumar', experience: '13 years', affiliation: 'KMCH', specialization: 'Dementia, Stroke, Epilepsy', location: 'Coimbatore' }
            ],
            'Indore': [
                { name: 'Dr. Amit Agrawal', experience: '20+ years', affiliation: 'Apollo Hospitals', specialization: 'Dementia, Alzheimer\'s, Stroke', location: 'Indore' },
                { name: 'Dr. V. K. Singh', experience: '15 years', affiliation: 'Medanta Hospital', specialization: 'Dementia, Epilepsy, Parkinson\'s', location: 'Indore' },
                { name: 'Dr. P. C. Sharma', experience: '25+ years', affiliation: 'Choithram Hospital', specialization: 'Dementia, Memory Disorders, Headache', location: 'Indore' },
                { name: 'Dr. K. K. Garg', experience: '18 years', affiliation: 'Bhandari Hospital', specialization: 'Dementia, Neuromuscular disorders', location: 'Indore' },
                { name: 'Dr. R. K. Singh', experience: '16 years', affiliation: 'CHL Hospitals', specialization: 'Dementia, Alzheimer\'s, Migraine', location: 'Indore' },
                { name: 'Dr. Manish Gupta', experience: '14 years', affiliation: 'Rajshree Hospital', specialization: 'Dementia, Stroke, Neuro-rehabilitation', location: 'Indore' },
                { name: 'Dr. Sanjay Dixit', experience: '10 years', affiliation: 'Life Care Hospital', specialization: 'Dementia, Neurological problems', location: 'Indore' },
                { name: 'Dr. Vishal Singh', experience: '12 years', affiliation: 'Bombay Hospital', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Indore' },
                { name: 'Dr. B. M. Mittal', experience: '17 years', affiliation: 'Vishesh Hospital', specialization: 'Dementia, Parkinson\'s, Movement Disorders', location: 'Indore' },
                { name: 'Dr. A. S. Yadav', experience: '19 years', affiliation: 'Apple Hospital', specialization: 'Dementia, Stroke, Multiple Sclerosis', location: 'Indore' }
            ],
            'Chandigarh': [
                { name: 'Dr. R. K. Aggarwal', experience: '30+ years', affiliation: 'Fortis Hospital', specialization: 'Dementia, Parkinson\'s, Epilepsy', location: 'Chandigarh' },
                { name: 'Dr. Vivek Kumar', experience: '20 years', affiliation: 'Post Graduate Institute of Medical Education and Research (PGIMER)', specialization: 'Dementia, Alzheimer\'s, Neurodegenerative disorders', location: 'Chandigarh' },
                { name: 'Dr. R. S. Bhatia', experience: '18 years', affiliation: 'Max Super Speciality Hospital', specialization: 'Dementia, Stroke, Headache', location: 'Chandigarh' },
                { name: 'Dr. Sandeep Singh', experience: '15 years', affiliation: 'Apollo Hospital', specialization: 'Dementia, Migraine, Neurological problems', location: 'Chandigarh' },
                { name: 'Dr. Amit Varma', experience: '16 years', affiliation: 'Ivy Hospital', specialization: 'Dementia, Memory loss, Stroke', location: 'Chandigarh' },
                { name: 'Dr. P. K. Singh', experience: '14 years', affiliation: 'GMCH-32', specialization: 'Dementia, Alzheimer\'s, Epilepsy', location: 'Chandigarh' },
                { name: 'Dr. B. S. Chahal', experience: '10 years', affiliation: 'Alchemist Hospital', specialization: 'Dementia, Parkinson\'s, Neuromuscular disorders', location: 'Chandigarh' },
                { name: 'Dr. Vikas Kumar', experience: '11 years', affiliation: 'Goyal Hospital', specialization: 'Dementia, Neuro-rehabilitation', location: 'Chandigarh' },
                { name: 'Dr. S. K. Gupta', experience: '17 years', affiliation: 'Healing Hospital', specialization: 'Dementia, Neurological problems', location: 'Chandigarh' },
                { name: 'Dr. S. K. Sharma', experience: '19 years', affiliation: 'E-7 Hospital', specialization: 'Dementia, Stroke, Multiple Sclerosis', location: 'Chandigarh' }
            ]
        };


        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            navigate(window.location.hash);
            displayDoctors('Chennai'); // Display Chennai doctors by default on load
        });
        navHome.addEventListener('click', () => navigate('#home'));
        navMri.addEventListener('click', () => navigate('#mri'));
        navVoice.addEventListener('click', () => navigate('#voice'));
        navRoutine.addEventListener('click', () => navigate('#routine'));
        navChat.addEventListener('click', () => navigate('#chat'));
        navDoctors.addEventListener('click', () => navigate('#doctors'));
        navCards.forEach(card => card.addEventListener('click', (e) => {
            e.preventDefault();
            navigate(e.currentTarget.getAttribute('href'));
        }));
        mriUpload.addEventListener('change', handleFileSelect);
        analyzeMriBtn.addEventListener('click', handleMriAnalysis);
        startRecordBtn.addEventListener('click', startRecording);
        stopRecordBtn.addEventListener('click', stopRecording);
        audioUpload.addEventListener('change', handleAudioFileSelect);
        analyzeVoiceBtn.addEventListener('click', handleVoiceAnalysis);
        generateActivityBtns.forEach(btn => btn.addEventListener('click', handleGenerateActivity));
        chatForm.addEventListener('submit', handleChatSubmit);
        generateCognitiveBoostBtn.addEventListener('click', handleGenerateCognitiveBoost);
        generateAlzheimersInsightBtn.addEventListener('click', handleGenerateAlzheimersInsight);
        citySelect.addEventListener('change', (event) => {
            displayDoctors(event.target.value);
        });


        // --- Navigation ---
        function navigate(hash) {
            hash = hash || '#home';
            window.location.hash = hash;

            [homeSection, mriSection, voiceSection, routineSection, chatSection, doctorsSection].forEach(sec => sec.classList.add('hidden'));
            [navHome, navMri, navVoice, navRoutine, navChat, navDoctors].forEach(nav => nav.classList.remove('active'));

            if (hash === '#voice') {
                voiceSection.classList.remove('hidden');
                navVoice.classList.add('active');
            } else if (hash === '#mri') {
                mriSection.classList.remove('hidden');
                navMri.classList.add('active');
            } else if (hash === '#routine') {
                routineSection.classList.remove('hidden');
                navRoutine.classList.add('active');
            } else if (hash === '#chat') {
                chatSection.classList.remove('hidden');
                navChat.classList.add('active');
            } else if (hash === '#doctors') {
                doctorsSection.classList.remove('hidden');
                navDoctors.classList.add('active');
            } else {
                homeSection.classList.remove('hidden');
                navHome.classList.add('active');
            }
        }

        // --- Doctors Display Function ---
        function displayDoctors(city) {
            doctorsList.innerHTML = ''; // Clear previous list
            const doctors = doctorsData[city];
            if (doctors && doctors.length > 0) {
                doctors.forEach(doctor => {
                    const doctorCard = document.createElement('div');
                    doctorCard.className = 'bg-gray-50 p-6 rounded-lg shadow-md border border-gray-200';
                    doctorCard.innerHTML = `
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">${doctor.name}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                            <div>
                                <p><strong>Years of Experience:</strong> ${doctor.experience}</p>
                                <p><strong>Primary Affiliation:</strong> ${doctor.affiliation}</p>
                            </div>
                            <div>
                                <p><strong>Key Specializations:</strong> ${doctor.specialization}</p>
                                <p><strong>Location:</strong> ${doctor.location}</p>
                            </div>
                        </div>
                    `;
                    doctorsList.appendChild(doctorCard);
                });
            } else {
                doctorsList.innerHTML = '<p class="text-center text-gray-500">No doctors found for this city. Please check back later.</p>';
            }
        }


        // --- MRI Analysis Functions ---
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                fileName.textContent = file.name;
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
                convertToBase64(file);
                analyzeMriBtn.disabled = false;
                mriResultSection.classList.add('hidden');
                mriErrorMessage.classList.add('hidden');
            }
        }

        function convertToBase64(file) {
            mriImageData.mimeType = file.type;
            const reader = new FileReader();
            reader.onloadend = () => {
                mriImageData.base64 = reader.result.split(',')[1];
            };
            reader.readAsDataURL(file);
        }

        async function handleMriAnalysis() {
            if (!mriImageData.base64) {
                showError(mriErrorMessage, "Please upload an MRI scan first.");
                return;
            }
            mriResultSection.classList.remove('hidden');
            mriLoader.classList.remove('hidden');
            mriResultText.innerHTML = '';
            analyzeMriBtn.disabled = true;
            mriErrorMessage.classList.add('hidden');

            try {
                const prompt = `Analyze this brain MRI scan for signs of Alzheimer's disease. Structure your response with the following markdown headings: "**Conclusion:**", "**Key Observations:**", and "**Disclaimer:**". Under "Key Observations:", list your findings as bullet points starting with an asterisk. Under "Disclaimer:", include the standard text about this not being a medical diagnosis.`;
                const analysisResult = await callGeminiAPI(prompt, [{ inlineData: { mimeType: mriImageData.mimeType, data: mriImageData.base64 } }]);
                displayResult(mriResultText, analysisResult);
            } catch (error) {
                console.error("MRI API Call Error:", error);
                showError(mriErrorMessage, `Error: ${error.message}`);
            } finally {
                mriLoader.classList.add('hidden');
                analyzeMriBtn.disabled = false;
            }
        }

        // --- Voice Analysis Functions ---
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = []; // Clear previous chunks
                uploadedAudioData = { base64: null, mimeType: null }; // Clear uploaded data
                recordedAudioData = { base64: null, mimeType: null }; // Clear previous recorded data
                audioFileName.textContent = 'No file selected'; // Clear uploaded file name
                audioUpload.disabled = true; // Disable upload when recording

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                // Add an error handler for MediaRecorder
                mediaRecorder.onerror = (e) => {
                    console.error("MediaRecorder error:", e.error);
                    showError(voiceErrorMessage, `Recording failed: ${e.error.name}. Please ensure microphone access is granted.`);
                    stopRecording(); // Attempt to stop cleanly
                };

                mediaRecorder.onstop = async () => { // Made async to await convertFileToBase64
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    audioPlayer.src = audioUrl;
                    audioPlaybackSection.classList.remove('hidden');
                    
                    // Store the recorded audio data as base64
                    recordedAudioData = await convertFileToBase64(audioBlob);

                    analyzeVoiceBtn.disabled = false;
                    audioChunks = []; // Clear chunks after processing
                };
                mediaRecorder.start();
                startRecordBtn.disabled = true;
                startRecordBtn.classList.add('recording');
                stopRecordBtn.disabled = false;
                analyzeVoiceBtn.disabled = true;
                voiceResultSection.classList.add('hidden');
                voiceErrorMessage.classList.add('hidden');
            } catch (err) {
                console.error("Error accessing microphone:", err);
                showError(voiceErrorMessage, "Could not access microphone. Please grant permission and try again.");
                startRecordBtn.disabled = false; // Enable start button again on error
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            startRecordBtn.disabled = false;
            startRecordBtn.classList.remove('recording');
            stopRecordBtn.disabled = true;
            audioUpload.disabled = false; // Re-enable upload after recording stops
        }

        function handleAudioFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                audioFileName.textContent = file.name;
                const reader = new FileReader();
                reader.onload = (e) => {
                    audioPlayer.src = e.target.result;
                    audioPlaybackSection.classList.remove('hidden');
                };
                reader.readAsDataURL(file);

                // Convert to base64 for API call
                convertFileToBase64(file).then(data => {
                    uploadedAudioData = data;
                    analyzeVoiceBtn.disabled = false;
                });
                
                // Disable live recording buttons and reset state
                startRecordBtn.disabled = true;
                stopRecordBtn.disabled = true;
                startRecordBtn.classList.remove('recording');
                audioChunks = []; // Clear any existing recording chunks
                recordedAudioData = { base64: null, mimeType: null }; // Clear recorded data
                voiceResultSection.classList.add('hidden');
                voiceErrorMessage.classList.add('hidden');
            } else {
                audioFileName.textContent = 'No file selected';
                audioPlayer.src = '';
                audioPlaybackSection.classList.add('hidden');
                uploadedAudioData = { base64: null, mimeType: null };
                analyzeVoiceBtn.disabled = true;
                // Re-enable start record button if no file is selected
                startRecordBtn.disabled = false; 
            }
        }

        async function handleVoiceAnalysis() {
            voiceResultSection.classList.remove('hidden');
            voiceLoader.classList.remove('hidden');
            voiceResultText.innerHTML = '';
            analyzeVoiceBtn.disabled = true;
            voiceErrorMessage.classList.add('hidden');

            try {
                const prompt = `A user read the following text aloud: "${textToRead}". Analyze this audio for linguistic markers potentially associated with early-stage Alzheimer's. Pay attention to pace, pauses, and speech patterns. Structure your response with the following markdown headings: "**Conclusion:**", "**Linguistic Analysis:**", and "**Disclaimer:**". Under "Linguistic Analysis:", list your findings as bullet points starting with an asterisk. Under "Disclaimer:", include the standard text about this being a simulation and not a real medical diagnosis based on speech.`;

                let audioParts = [];
                // Prioritize recorded audio, then uploaded audio
                if (recordedAudioData.base64) {
                    audioParts = [{ inlineData: { mimeType: recordedAudioData.mimeType, data: recordedAudioData.base64 } }];
                } else if (uploadedAudioData.base64) {
                    audioParts = [{ inlineData: { mimeType: uploadedAudioData.mimeType, data: uploadedAudioData.base64 } }];
                } else {
                    showError(voiceErrorMessage, "Please record audio or upload an audio file first.");
                    voiceLoader.classList.add('hidden');
                    analyzeVoiceBtn.disabled = false;
                    return;
                }

                const analysisResult = await callGeminiAPI(prompt, audioParts);
                displayResult(voiceResultText, analysisResult);

            } catch (error) {
                console.error("Voice API Call Error:", error);
                showError(voiceErrorMessage, `Error: ${error.message}`);
            } finally {
                voiceLoader.classList.add('hidden');
                analyzeVoiceBtn.disabled = false;
            }
        }

        // Generic function to convert a File or Blob object to base64
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    resolve({
                        mimeType: file.type,
                        base64: reader.result.split(',')[1]
                    });
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // --- Routine Generation Function ---
        async function handleGenerateActivity(event) {
            const btn = event.currentTarget;
            const timeOfDay = btn.dataset.time;
            const activityElementId = `${timeOfDay}-activity`;
            const activityElement = document.getElementById(activityElementId);

            btn.disabled = true;
            btn.innerHTML = `<div class="loader mx-auto" style="width:20px; height:20px; border-top-color:white;"></div>`;
            routineErrorMessage.classList.add('hidden');

            try {
                const prompt = `Suggest one creative and simple ${timeOfDay} activity for a person with Alzheimer's. The activity should be safe and engaging. Describe it in one or two sentences.`;
                const newActivity = await callGeminiAPI(prompt, []);
                activityElement.innerHTML = `<strong>${timeOfDay.charAt(0).toUpperCase() + timeOfDay.slice(1)} Activity:</strong> ${newActivity}`;
            } catch (error) {
                console.error("Activity Generation Error:", error);
                showError(routineErrorMessage, `Failed to generate activity. Please try again.`);
            } finally {
                btn.disabled = false;
                btn.innerHTML = `âœ¨ Generate ${timeOfDay.charAt(0).toUpperCase() + timeOfDay.slice(1)} Activity`;
            }
        }

        // --- New Home Page Gemini Feature Functions ---
        async function handleGenerateCognitiveBoost() {
            generateCognitiveBoostBtn.disabled = true;
            cognitiveBoostLoader.classList.remove('hidden');
            cognitiveBoostResult.classList.add('hidden');
            cognitiveBoostErrorMessage.classList.add('hidden');

            try {
                const prompt = `Provide one concise, positive, and actionable tip or a simple activity idea (1-2 sentences) to support cognitive well-being for someone with early-stage cognitive decline. Focus on engagement and simplicity.`;
                const boost = await callGeminiAPI(prompt, []);
                cognitiveBoostResult.textContent = boost;
                cognitiveBoostResult.classList.remove('hidden');
            } catch (error) {
                console.error("Cognitive Boost API Call Error:", error);
                showError(cognitiveBoostErrorMessage, `Failed to get cognitive boost. Error: ${error.message}`);
            } finally {
                cognitiveBoostLoader.classList.add('hidden');
                generateCognitiveBoostBtn.disabled = false;
            }
        }

        async function handleGenerateAlzheimersInsight() {
            generateAlzheimersInsightBtn.disabled = true;
            alzheimersInsightLoader.classList.remove('hidden');
            alzheimersInsightResult.classList.add('hidden');
            alzheimersInsightErrorMessage.classList.add('hidden');

            try {
                const prompt = `Provide one concise, interesting fact or clarify a common misconception about Alzheimer's disease (1-2 sentences). Ensure it's accurate and easy to understand.`;
                const insight = await callGeminiAPI(prompt, []);
                alzheimersInsightResult.textContent = insight;
                alzheimersInsightResult.classList.remove('hidden');
            } catch (error) {
                console.error("Alzheimer's Insight API Call Error:", error);
                showError(alzheimersInsightErrorMessage, `Failed to get insight. Error: ${error.message}`);
            } finally {
                alzheimersInsightLoader.classList.add('hidden');
                generateAlzheimersInsightBtn.disabled = false;
            }
        }


        // --- Chatbot Functions ---
        async function handleChatSubmit(event) {
            event.preventDefault();
            const userInput = chatInput.value.trim();
            if (!userInput) return;

            addMessageToChatWindow('user', userInput);
            chatInput.value = '';
            chatForm.querySelector('button').disabled = true;
            addMessageToChatWindow('model', '...'); // Typing indicator

            try {
                const systemInstruction = `You are an empathetic and supportive AI assistant for caregivers of people with Alzheimer's. Provide practical, safe, and compassionate advice. Do not provide medical diagnoses. Structure your responses with markdown for clarity (e.g., use **headings** and * bullet points).`;

                let fullPrompt = userInput;
                if (chatHistory.length === 0) {
                    fullPrompt = `${systemInstruction}\n\n**User Question:**\n${userInput}`;
                }

                chatHistory.push({ role: "user", parts: [{ text: fullPrompt }] });

                const responseText = await callGeminiAPI(null, null, chatHistory);
                
                chatHistory.push({ role: "model", parts: [{ text: responseText }] });
                
                updateLastModelMessage(responseText, true); // Pass true to format the response

            } catch (error) {
                console.error("Chat API Error:", error);
                updateLastModelMessage("Sorry, I encountered an error. Please try again.", false);
                showError(chatErrorMessage, `Error: ${error.message}`);
            } finally {
                chatForm.querySelector('button').disabled = false;
            }
        }

        function addMessageToChatWindow(role, text) {
            const messageContainer = document.createElement('div');
            messageContainer.className = `chat-message-container ${role === 'user' ? 'justify-end' : 'justify-start'}`;

            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message-content ${role === 'user' ? 'chat-message-user' : 'chat-message-model'}`;
            messageDiv.textContent = text;
            
            messageContainer.appendChild(messageDiv);
            chatWindow.appendChild(messageContainer);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function updateLastModelMessage(text, isFormatted = false) {
            const lastMessageContainer = chatWindow.lastChild;
            const lastMessageContent = lastMessageContainer ? lastMessageContainer.querySelector('.chat-message-content') : null;
            if (lastMessageContent) {
                if (isFormatted) {
                    lastMessageContent.innerHTML = formatChatMessage(text);
                } else {
                    lastMessageContent.textContent = text;
                }
            }
        }

        function formatChatMessage(text) {
            // Replace **headings** with <strong> tags
            let formattedText = text.replace(/\*\*(.*?):\*\*/g, '<strong class="font-semibold block mt-2 mb-1">$1</strong>');
            
            // Replace * list items with HTML list items
            const lines = formattedText.split('\n');
            let inList = false;
            const processedLines = lines.map(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.startsWith('*')) {
                    if (!inList) {
                        inList = true;
                        return '<ul><li class="list-disc ml-5">' + trimmedLine.substring(1).trim() + '</li>';
                    }
                    return '<li class="list-disc ml-5">' + trimmedLine.substring(1).trim() + '</li>';
                } else {
                    if (inList) {
                        inList = false;
                        return '</ul>' + trimmedLine;
                    }
                    return trimmedLine;
                }
            });

            if (inList) {
                processedLines.push('</ul>');
            }

            return processedLines.join('<br>').replace(/<br><ul>/g, '<ul>').replace(/<\/ul><br>/g, '</ul>');
        }


        // --- Generic Gemini API Caller ---
        async function callGeminiAPI(prompt, additionalParts, history = []) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            let contents;
            if (history.length > 0) {
                contents = history;
            } else {
                const parts = [{ text: prompt }];
                if (additionalParts && additionalParts.length > 0) {
                    parts.push(...additionalParts);
                }
                contents = [{ role: "user", parts: parts }];
            }
            
            const payload = {
                contents: contents,
                generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 2048
                }
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API request failed: ${errorData.error.message}`);
            }

            const result = await response.json();
            const candidate = result.candidates && result.candidates[0];

            if (candidate && candidate.content && candidate.content.parts && candidate.content.parts.length > 0) {
                return candidate.content.parts[0].text;
            } else {
                console.warn("Unexpected API response structure:", result);
                if (candidate && candidate.finishReason && candidate.finishReason !== 'STOP') {
                    throw new Error(`Analysis stopped by the model. Reason: ${candidate.finishReason}`);
                }
                if (result.promptFeedback && result.promptFeedback.blockReason) {
                    throw new Error(`Request was blocked. Reason: ${result.promptFeedback.blockReason}`);
                }
                throw new Error("The model did not return a valid analysis.");
            }
        }

        // --- UI Helper Functions ---
        function displayResult(element, result) {
            element.innerHTML = '';
            
            const sections = result.split(/\*\*(.*?):\*\*/).filter(Boolean);

            for (let i = 0; i < sections.length; i += 2) {
                const title = sections[i];
                const content = sections[i+1];

                if (title && content) {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'mb-4';

                    const titleEl = document.createElement('h3');
                    titleEl.className = 'text-lg font-semibold text-gray-800 mb-2 border-b pb-1';
                    titleEl.textContent = title;
                    sectionDiv.appendChild(titleEl);

                    if (content.includes('*')) {
                        const list = document.createElement('ul');
                        list.className = 'list-disc list-inside space-y-1 text-gray-700';
                        const items = content.trim().split('*').filter(Boolean);
                        items.forEach(itemText => {
                            const listItem = document.createElement('li');
                            listItem.textContent = itemText.trim();
                            list.appendChild(listItem);
                        });
                        sectionDiv.appendChild(list);
                    } else {
                        const contentEl = document.createElement('p');
                        contentEl.className = 'text-gray-700';
                        contentEl.textContent = content.trim();
                        sectionDiv.appendChild(contentEl);
                    }
                    element.appendChild(sectionDiv);
                }
            }
            element.classList.remove('hidden');
        }

        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }
    </script>

</body>
</html>
